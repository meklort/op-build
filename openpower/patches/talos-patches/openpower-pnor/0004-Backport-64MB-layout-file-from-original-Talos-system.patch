From 6b47dc80c3808eda837f0f653b5019a8c0b2c351 Mon Sep 17 00:00:00 2001
From: Raptor Engineering Development Team <support@raptorengineering.com>
Date: Sun, 15 Apr 2018 17:26:11 -0500
Subject: [PATCH 4/5] Backport 64MB layout file from original Talos systems
 Extend kernel partition to 31MB

---
 p9Layouts/defaultPnorLayout_64.xml | 52 ++++++++++++++++++++++----------------
 1 file changed, 30 insertions(+), 22 deletions(-)

diff --git a/p9Layouts/defaultPnorLayout_64.xml b/p9Layouts/defaultPnorLayout_64.xml
index a39d550..881e335 100644
--- a/p9Layouts/defaultPnorLayout_64.xml
+++ b/p9Layouts/defaultPnorLayout_64.xml
@@ -167,7 +167,7 @@ Layout Description
         <ecc/>
     </section>
     <section>
-        <description>Hostboot Extended image (11MB w/o ECC)</description>
+        <description>Hostboot Extended image (13MB w/o ECC)</description>
         <eyeCatch>HBI</eyeCatch>
         <physicalOffset>0x425000</physicalOffset>
         <physicalRegionSize>0xEA0000</physicalRegionSize>
@@ -197,10 +197,10 @@ Layout Description
         <ecc/>
     </section>
     <section>
-        <description>Hostboot Runtime Services for Sapphire (6MB)</description>
+        <description>Hostboot Runtime Services for Sapphire (5.5MB)</description>
         <eyeCatch>HBRT</eyeCatch>
         <physicalOffset>0x14A1000</physicalOffset>
-        <physicalRegionSize>0x600000</physicalRegionSize>
+        <physicalRegionSize>0x580000</physicalRegionSize>
         <side>A</side>
         <sha512Version/>
         <readOnly/>
@@ -209,17 +209,17 @@ Layout Description
     <section>
         <description>Payload (1MB)</description>
         <eyeCatch>PAYLOAD</eyeCatch>
-        <physicalOffset>0x1AA1000</physicalOffset>
+        <physicalOffset>0x1A21000</physicalOffset>
         <physicalRegionSize>0x100000</physicalRegionSize>
         <side>A</side>
         <sha512Version/>
         <readOnly/>
     </section>
     <section>
-        <description>Bootloader Kernel (15MB)</description>
+        <description>Bootloader Kernel (31MB)</description>
         <eyeCatch>BOOTKERNEL</eyeCatch>
-        <physicalOffset>0x1BA1000</physicalOffset>
-        <physicalRegionSize>0xF00000</physicalRegionSize>
+        <physicalOffset>0x1B21000</physicalOffset>
+        <physicalRegionSize>0x1F00000</physicalRegionSize>
         <side>A</side>
         <sha512Version/>
         <readOnly/>
@@ -227,7 +227,7 @@ Layout Description
     <section>
         <description>OCC Lid (1.125M)</description>
         <eyeCatch>OCC</eyeCatch>
-        <physicalOffset>0x2AA1000</physicalOffset>
+        <physicalOffset>0x3A21000</physicalOffset>
         <physicalRegionSize>0x120000</physicalRegionSize>
         <side>A</side>
         <sha512Version/>
@@ -237,7 +237,7 @@ Layout Description
     <section>
         <description>Checkstop FIR data (12K)</description>
         <eyeCatch>FIRDATA</eyeCatch>
-        <physicalOffset>0x2BC1000</physicalOffset>
+        <physicalOffset>0x3B41000</physicalOffset>
         <physicalRegionSize>0x3000</physicalRegionSize>
         <side>A</side>
         <ecc/>
@@ -247,7 +247,7 @@ Layout Description
     <section>
         <description>CAPP Lid (144K)</description>
         <eyeCatch>CAPP</eyeCatch>
-        <physicalOffset>0x2BC4000</physicalOffset>
+        <physicalOffset>0x3B44000</physicalOffset>
         <physicalRegionSize>0x24000</physicalRegionSize>
         <side>A</side>
         <sha512Version/>
@@ -257,7 +257,7 @@ Layout Description
     <section>
         <description>BMC Inventory (36K)</description>
         <eyeCatch>BMC_INV</eyeCatch>
-        <physicalOffset>0x2BE8000</physicalOffset>
+        <physicalOffset>0x3B68000</physicalOffset>
         <physicalRegionSize>0x9000</physicalRegionSize>
         <side>sideless</side>
         <reprovision/>
@@ -265,7 +265,7 @@ Layout Description
     <section>
         <description>Hostboot Bootloader (28K)</description>
         <eyeCatch>HBBL</eyeCatch>
-        <physicalOffset>0x2BF1000</physicalOffset>
+        <physicalOffset>0x3B71000</physicalOffset>
         <!-- Physical Size includes Header rounded to ECC valid size -->
         <!-- Max size of actual HBBL content is 20K and 22.5K with ECC -->
         <physicalRegionSize>0x7000</physicalRegionSize>
@@ -277,7 +277,7 @@ Layout Description
     <section>
         <description>Temporary Attribute Override (32K)</description>
         <eyeCatch>ATTR_TMP</eyeCatch>
-        <physicalOffset>0x2BF8000</physicalOffset>
+        <physicalOffset>0x3B78000</physicalOffset>
         <physicalRegionSize>0x8000</physicalRegionSize>
         <side>A</side>
         <reprovision/>
@@ -285,7 +285,7 @@ Layout Description
     <section>
         <description>Permanent Attribute Override (32K)</description>
         <eyeCatch>ATTR_PERM</eyeCatch>
-        <physicalOffset>0x2C00000</physicalOffset>
+        <physicalOffset>0x3B80000</physicalOffset>
         <physicalRegionSize>0x8000</physicalRegionSize>
         <side>A</side>
         <ecc/>
@@ -295,7 +295,7 @@ Layout Description
     <section>
         <description>PNOR Version (4K)</description>
         <eyeCatch>VERSION</eyeCatch>
-        <physicalOffset>0x2C08000</physicalOffset>
+        <physicalOffset>0x3B88000</physicalOffset>
         <physicalRegionSize>0x1000</physicalRegionSize>
         <side>A</side>
         <readOnly/>
@@ -303,7 +303,7 @@ Layout Description
     <section>
         <description>IMA Catalog (256K)</description>
         <eyeCatch>IMA_CATALOG</eyeCatch>
-        <physicalOffset>0x2C09000</physicalOffset>
+        <physicalOffset>0x3B89000</physicalOffset>
         <physicalRegionSize>0x40000</physicalRegionSize>
         <side>A</side>
         <sha512Version/>
@@ -313,7 +313,7 @@ Layout Description
     <section>
         <description>Ref Image Ring Overrides (128K)</description>
         <eyeCatch>RINGOVD</eyeCatch>
-        <physicalOffset>0x2C49000</physicalOffset>
+        <physicalOffset>0x3BC9000</physicalOffset>
         <physicalRegionSize>0x20000</physicalRegionSize>
         <side>A</side>
     </section>
@@ -322,7 +322,7 @@ Layout Description
         <!-- We need 266KB per module sort, going to support
              10 sorts by default, plus ECC  -->
         <eyeCatch>WOFDATA</eyeCatch>
-        <physicalOffset>0x2C69000</physicalOffset>
+        <physicalOffset>0x3BE9000</physicalOffset>
         <physicalRegionSize>0x300000</physicalRegionSize>
         <side>A</side>
         <sha512Version/>
@@ -332,7 +332,7 @@ Layout Description
     <section>
         <description>Hostboot deconfig area (64KB)</description>
         <eyeCatch>HB_VOLATILE</eyeCatch>
-        <physicalOffset>0x2F69000</physicalOffset>
+        <physicalOffset>0x3EE9000</physicalOffset>
         <physicalRegionSize>0x5000</physicalRegionSize>
         <side>A</side>
         <reprovision/>
@@ -343,7 +343,7 @@ Layout Description
     <section>
         <description>Memory config data (28K)</description>
         <eyeCatch>MEMD</eyeCatch>
-        <physicalOffset>0x2F6E000</physicalOffset>
+        <physicalOffset>0x3EEE000</physicalOffset>
         <physicalRegionSize>0xE000</physicalRegionSize>
         <side>A</side>
         <sha512Version/>
@@ -353,7 +353,7 @@ Layout Description
     <section>
         <description>SecureBoot Key Transition Partition (16K)</description>
         <eyeCatch>SBKT</eyeCatch>
-        <physicalOffset>0x2F82000</physicalOffset>
+        <physicalOffset>0x3F02000</physicalOffset>
         <physicalRegionSize>0x4000</physicalRegionSize>
         <side>A</side>
         <sha512Version/>
@@ -363,11 +363,19 @@ Layout Description
     <section>
         <description>HDAT binary data (16KB)</description>
         <eyeCatch>HDAT</eyeCatch>
-        <physicalOffset>0x2F86000</physicalOffset>
+        <physicalOffset>0x3F06000</physicalOffset>
         <physicalRegionSize>0x8000</physicalRegionSize>
         <side>sideless</side>
         <sha512Version/>
         <readOnly/>
         <ecc/>
     </section>
+    <section>
+        <description>Boot kernel firmware data (800KB)</description>
+        <eyeCatch>BOOTKERNFW</eyeCatch>
+        <physicalOffset>0x3F10000</physicalOffset>
+        <physicalRegionSize>0xE0000</physicalRegionSize>
+        <side>sideless</side>
+        <preserved/>
+    </section>
 </pnor>
-- 
2.11.0

